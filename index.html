<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Video Editor</h1>
            <div class="metadata-panel" id="metadata-panel" style="display: none;">
                <span id="filename"></span>
                <span id="duration"></span>
                <span id="resolution"></span>
            </div>
        </header>

        <main class="main-content">
            <div class="drop-zone" id="drop-zone">
                <div class="drop-zone-content">
                    <p>Drag a video file here or</p>
                    <button class="open-button" id="open-button">Choose File</button>
                    <p style="margin-top: 0.75rem; color: #aaa; font-size: 0.95rem;">
                        Or <a href="#" id="load-sample-link">load a sample file</a>
                    </p>
                    <input type="file" id="file-input" accept="video/*" style="display: none;">
                </div>
            </div>

            <div class="video-container" id="video-container" style="display: none;">
                <video 
                    id="video-element" 
                    preload="metadata"
                    style="display: none;"
                ></video>
                <canvas 
                    id="canvas-element"
                    class="video-canvas"
                ></canvas>
            </div>

            <div class="timeline-section" id="timeline-section" style="display: none;">
                <div id="timeline-frames" class="timeline-frames"></div>
            </div>

            <div class="controls-panel" id="controls-panel" style="display: none;">
                <button id="seek-beginning-button" class="seek-button" title="Seek to beginning (or selection start)" aria-label="Seek to beginning">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M4 6h2v12H4z" fill="currentColor"/>
                        <path d="M20 18l-10-6 10-6v12z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="rewind-button" class="skip-button" title="Rewind (smart duration)" aria-label="Rewind">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M11 18l-8-6 8-6v12z" fill="currentColor"/>
                        <path d="M21 18l-8-6 8-6v12z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="play-pause-button" aria-label="Play/Pause">
                    <svg class="play-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 5v14l11-7L8 5z" fill="currentColor"/>
                    </svg>
                    <svg class="pause-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4h4v16H6V4zM14 4h4v16h-4V4z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="stop-button" class="stop-button" title="Stop and reset to beginning" aria-label="Stop">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <rect x="6" y="6" width="12" height="12" fill="currentColor"/>
                    </svg>
                </button>
                <button id="forward-button" class="skip-button" title="Forward (smart duration)" aria-label="Forward">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M13 6l8 6-8 6V6z" fill="currentColor"/>
                        <path d="M3 6l8 6-8 6V6z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="seek-end-button" class="seek-button" title="Seek to end (or selection end)" aria-label="Seek to end">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M4 6l10 6-10 6V6z" fill="currentColor"/>
                        <path d="M18 6h2v12h-2z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="loop-button" class="loop-button" title="Loop selection or video" aria-label="Toggle loop">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M17 1l4 4-4 4" fill="currentColor"/>
                        <path d="M3 12a6 6 0 0 1 6-6h12v2H9a4 4 0 0 0-4 4v0" fill="currentColor"/>
                        <path d="M7 23l-4-4 4-4" fill="currentColor"/>
                        <path d="M21 12a6 6 0 0 1-6 6H3v-2h12a4 4 0 0 0 4-4v0" fill="currentColor"/>
                    </svg>
                </button>
                <button id="export-global-button" class="icon-button" title="Export video" aria-label="Export video">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 13v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <div class="volume-control">
                    <label id="volume-label" for="volume-slider">Volume</label>
                    <input
                        id="volume-slider"
                        type="range"
                        min="0"
                        max="100"
                        step="1"
                        value="100"
                        aria-label="Volume"
                    />
                    <span id="volume-percentage" aria-hidden="true">100%</span>
                </div>
                <div class="selection-info" id="selection-info" style="display: none;">
                    <span class="selection-label">Selection:</span>
                    <span class="selection-time">In:
                        <input id="selection-start-input" class="time-input" type="text" inputmode="numeric" placeholder="00:00:00.000" aria-label="Selection start time" />
                    </span>
                    <span class="selection-time">Out:
                        <input id="selection-end-input" class="time-input" type="text" inputmode="numeric" placeholder="00:00:00.000" aria-label="Selection end time" />
                    </span>
                    <span class="selection-time">Duration: <span id="selection-duration">--:--</span></span>
                    <button id="restore-selection-button" class="icon-button" title="Restore deleted fragments in selection" aria-label="Restore deleted">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M12 5v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 13a7 7 0 1 1-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button id="clear-selection-button" class="icon-button" title="Clear selection" aria-label="Clear selection">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button id="delete-selection-button" class="icon-button" title="Delete selection (Delete/Backspace)" aria-label="Delete selection">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M10 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <button id="export-button" class="icon-button" title="Export selection" aria-label="Export selection">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 13v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </main>
    </div>
    <script>
        // Register COOP/COEP service worker to enable SharedArrayBuffer for FFmpeg.wasm
        if ('serviceWorker' in navigator) {
            // Use a relative path so it works on GitHub Pages (project subpath)
            navigator.serviceWorker.register('sw.js', { scope: './' })
                .catch((err) => { console.warn('SW register failed', err); });
            // If the page isn't cross-origin isolated yet, reload once SW is ready (only once)
            if (!window.crossOriginIsolated) {
                navigator.serviceWorker.ready.then(() => {
                    if (!sessionStorage.getItem('coi-reloaded')) {
                        sessionStorage.setItem('coi-reloaded', '1');
                        window.location.reload();
                    }
                }).catch(() => {});
            }
        }
    </script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
